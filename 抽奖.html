<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢æ¢5å‘¨å¹´å¤§æŠ½å¥–</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #ffb822;
            background: linear-gradient(180deg, #ffcf4b 0%, #ff9a00 100%);
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header { text-align: center; margin-top: 30px; color: #d93600; }
        .header h1 { font-size: 24px; font-weight: bold; border: 2px solid #333; display: inline-block; padding: 5px 20px; margin-bottom: 10px; }
        .header h2 { font-size: 32px; font-weight: 800; text-shadow: 1px 1px 2px rgba(255,255,255,0.5); }

        /* è½¬ç›˜å®¹å™¨ */
        .wheel-container {
            position: relative;
            width: 320px; height: 320px;
            margin: 20px auto;
            background: #e64c3c;
            border-radius: 50%;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 4px solid #ffeb3b;
        }
        .wheel-container::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%; border: 2px dashed #fff;
            animation: flash 1s infinite; pointer-events: none;
        }
        @keyframes flash { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        /* è½¬ç›˜ */
        .wheel {
            width: 100%; height: 100%;
            background: #fffdf0; border-radius: 50%;
            position: relative; overflow: hidden;
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.3, 1);
        }
        .wheel-bg {
            width: 100%; height: 100%; border-radius: 50%;
            background: conic-gradient(
                #fffdf0 0deg 60deg, #ffe0b2 60deg 120deg,
                #fffdf0 120deg 180deg, #ffe0b2 180deg 240deg,
                #fffdf0 240deg 300deg, #ffe0b2 300deg 360deg
            );
        }
        .prize-item {
            position: absolute; top: 0; left: 50%;
            width: 100px; height: 50%; margin-left: -50px;
            transform-origin: bottom center; text-align: center;
            padding-top: 20px; font-size: 12px; color: #d35400; font-weight: bold;
        }
        .item-1 { transform: rotate(30deg); }
        .item-2 { transform: rotate(90deg); }
        .item-3 { transform: rotate(150deg); }
        .item-4 { transform: rotate(210deg); }
        .item-5 { transform: rotate(270deg); }
        .item-6 { transform: rotate(330deg); }
        .prize-icon { display: block; width: 30px; height: 30px; background: #ddd; margin: 5px auto; border-radius: 4px; line-height: 30px; font-size: 10px; color: #666; }

        /* æŒ‡é’ˆæŒ‰é’® */
        .pointer {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80px; height: 80px;
            background: linear-gradient(to bottom, #ffcc00, #ff9900);
            border-radius: 50%; border: 4px solid #fff;
            box-shadow: 0 4px 0 #cc7a00;
            z-index: 10; display: flex; justify-content: center; align-items: center;
            font-size: 20px; font-weight: bold; color: #d35400; cursor: pointer;
        }
        .pointer::before {
            content: ''; position: absolute; top: -20px; left: 50%;
            transform: translateX(-50%);
            border-width: 15px; border-style: solid;
            border-color: transparent transparent #ffcc00 transparent;
        }
        .pointer:active { transform: translate(-50%, -48%); box-shadow: 0 2px 0 #cc7a00; }
        
        /* ç¦ç”¨çŠ¶æ€çš„æŒ‡é’ˆ */
        .pointer.disabled {
            background: #ccc;
            box-shadow: 0 4px 0 #999;
            color: #666;
            cursor: not-allowed;
        }
        .pointer.disabled::before { border-bottom-color: #ccc; }

        /* åº•éƒ¨åå• */
        .footer-list {
            width: 90%; background: rgba(255, 255, 255, 0.3);
            border-radius: 10px; padding: 10px; margin-top: 10px;
            text-align: center; z-index: 5; height: 150px; /* å›ºå®šé«˜åº¦ */
            display: flex; flex-direction: column;
        }
        .list-title { color: #fff; font-size: 14px; margin-bottom: 8px; font-weight: bold; flex-shrink: 0;}
        .marquee-container {
            flex: 1; overflow-y: auto; /* å…è®¸æ»šåŠ¨ */
            position: relative;
            -webkit-overflow-scrolling: touch;
        }
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .marquee-container::-webkit-scrollbar { width: 4px; }
        .marquee-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.5); border-radius: 2px; }

        .record-item {
            color: #fff; font-size: 12px; line-height: 24px;
            border-bottom: 1px dashed rgba(255,255,255,0.2);
        }
        .record-item b { color: #d93600; background: rgba(255,255,255,0.6); padding: 0 4px; border-radius: 4px; margin: 0 2px;}
        .record-time { font-size: 10px; color: #eee; margin-left: 5px; opacity: 0.8; }

        /* åŸå¸‚èƒŒæ™¯ */
        .city-bg {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            background-color: #e67e22;
            mask-image: linear-gradient(to top, black, transparent);
            -webkit-mask-image: linear-gradient(to top, black, transparent);
            opacity: 0.5; z-index: 0;
        }

        /* å¼¹çª— */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100; display: none;
            justify-content: center; align-items: center;
        }
        .modal-box {
            background: #fff; width: 80%; max-width: 300px; padding: 20px;
            border-radius: 15px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-title { font-size: 18px; color: #333; margin-bottom: 15px; font-weight: bold; }
        .modal-input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 15px; outline: none; }
        .modal-input:focus { border-color: #ff9900; }
        .modal-btn {
            background: linear-gradient(to right, #ff9900, #ff5e00);
            color: white; border: none; padding: 10px 30px; border-radius: 20px;
            font-size: 16px; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 94, 0, 0.3);
        }
    </style>
</head>
<body>

    <!-- å§“åè¾“å…¥å¼¹çª— -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal-box">
            <div class="modal-title">è¯·è¾“å…¥æ‚¨çš„å§“å</div>
            <input type="text" class="modal-input" id="usernameInput" placeholder="ä¾‹å¦‚ï¼šæå››" maxlength="10">
            <button class="modal-btn" onclick="submitName()">å¼€å§‹æŠ½å¥–</button>
        </div>
    </div>

    <div class="header">
        <h1>æ¢æ¢</h1>
        <h2>æ¢æ¢5å‘¨å¹´<br>æ‹‰äººå¤§æŠ½å¥–</h2>
    </div>

    <div class="wheel-container">
        <div class="wheel" id="wheel">
            <div class="wheel-bg"></div>
            <div class="prize-item item-1"><span>çºªæ¢µå¸Œ<br>å°ç¾Šçš®å£çº¢</span><span class="prize-icon">ğŸ’„</span></div>
            <div class="prize-item item-2"><span>ARMANI<br>é˜¿ç›å°¼</span><span class="prize-icon">ğŸ</span></div>
            <div class="prize-item item-3"><span>æ¢æ¢<br>VIPä¼šå‘˜</span><span class="prize-icon">ğŸ‘‘</span></div>
            <div class="prize-item item-4"><span>iPhone<br>XS</span><span class="prize-icon">ğŸ“±</span></div>
            <div class="prize-item item-5"><span>åœ£ç½—å…°<br>å£çº¢</span><span class="prize-icon">ğŸ’„</span></div>
            <div class="prize-item item-6"><span>è°¢è°¢<br>å‚ä¸</span><span class="prize-icon">ğŸ˜Š</span></div>
        </div>

        <!-- æŒ‰é’®å¢åŠ IDä»¥ä¾¿æ§åˆ¶ -->
        <div class="pointer" id="drawBtn" onclick="checkUserAndSpin()">
            æŠ½å¥–
        </div>
    </div>

    <div class="footer-list">
        <div class="list-title">â€”â€” ä¸­å¥–åå• (å®æ—¶æ›´æ–°) â€”â€”</div>
        <div class="marquee-container" id="marqueeList">
            <!-- åˆ—è¡¨å°†ç”±JSåŠ è½½ -->
        </div>
    </div>

    <div class="city-bg"></div>

    <script>
        // --- é…ç½®ä¸çŠ¶æ€ ---
        const STORAGE_KEY_RECORDS = 'lottery_records_v1';
        const STORAGE_KEY_LAST_DATE = 'lottery_last_date_v1';
        
        let isSpinning = false;
        let currentRotation = 0;
        let currentUser = "";

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            renderRecords();
            checkDailyStatus();
        };

        // 1. æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²æŠ½å¥–
        function checkDailyStatus() {
            const lastDate = localStorage.getItem(STORAGE_KEY_LAST_DATE);
            const today = new Date().toLocaleDateString();
            const btn = document.getElementById('drawBtn');

            if (lastDate === today) {
                btn.classList.add('disabled');
                btn.innerText = "å·²æŠ½";
                return false; // ç¦æ­¢æŠ½å¥–
            } else {
                btn.classList.remove('disabled');
                btn.innerText = "æŠ½å¥–";
                return true; // å…è®¸æŠ½å¥–
            }
        }

        // 2. æ¸²æŸ“ä¸­å¥–è®°å½• (åˆå¹¶é»˜è®¤æ•°æ®å’Œæœ¬åœ°å­˜å‚¨æ•°æ®)
        function renderRecords() {
            const listContainer = document.getElementById('marqueeList');
            listContainer.innerHTML = ''; // æ¸…ç©º

            // è·å–æœ¬åœ°å­˜å‚¨çš„è®°å½•
            let localRecords = JSON.parse(localStorage.getItem(STORAGE_KEY_RECORDS) || "[]");

            // é»˜è®¤è™šæ‹Ÿæ•°æ® (ä¸ºäº†çœ‹èµ·æ¥ä¸ç©º)
            const defaultRecords = [
                { name: "180****0182", prize: "iPhone XS", time: "2023/10/01" },
                { name: "183****1143", prize: "åœ£ç½—å…°å£çº¢", time: "2023/10/02" },
                { name: "138****8888", prize: "æ¢æ¢VIPä¼šå‘˜", time: "2023/10/03" }
            ];

            // åˆå¹¶ï¼šæ–°è®°å½•åœ¨æœ€å‰é¢
            const allRecords = [...localRecords.reverse(), ...defaultRecords];

            allRecords.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'record-item';
                // å¦‚æœæ²¡æœ‰æ—¶é—´å­—æ®µï¼Œå°±ä¸æ˜¾ç¤ºæ—¶é—´
                const timeStr = rec.time ? `<span class="record-time">${rec.time}</span>` : '';
                div.innerHTML = `æ­å–œ <b>${rec.name}</b> è·å¾— ${rec.prize} ${timeStr}`;
                listContainer.appendChild(div);
            });
        }

        // 3. ç‚¹å‡»æŠ½å¥–å‰ç½®æ£€æŸ¥
        function checkUserAndSpin() {
            if (isSpinning) return;

            // å†æ¬¡æ£€æŸ¥æ—¥æœŸé™åˆ¶
            if (!checkDailyStatus()) {
                alert("æ‚¨ä»Šå¤©å·²ç»æŠ½è¿‡å¥–äº†ï¼Œè¯·æ˜å¤©å†æ¥ï¼");
                return;
            }
            
            if (!currentUser) {
                document.getElementById('nameModal').style.display = 'flex';
                setTimeout(() => document.getElementById('usernameInput').focus(), 100);
            } else {
                startLottery();
            }
        }

        function submitName() {
            const input = document.getElementById('usernameInput');
            const name = input.value.trim();
            if (!name) { alert("è¯·è¾“å…¥å§“å"); return; }
            currentUser = name;
            document.getElementById('nameModal').style.display = 'none';
            startLottery();
        }

        // 4. æ ¸å¿ƒæŠ½å¥–é€»è¾‘
        function startLottery() {
            if (isSpinning) return;
            isSpinning = true;

            const wheel = document.getElementById('wheel');
            const baseSpins = 1800; 
            const randomOffset = Math.floor(Math.random() * 360);
            currentRotation += (baseSpins + randomOffset);
            wheel.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                isSpinning = false;
                
                // è®¡ç®—ç»“æœ
                const actualDeg = currentRotation % 360;
                let pointingDeg = 360 - actualDeg;
                if (pointingDeg === 360) pointingDeg = 0;

                let prize = "";
                if (pointingDeg >= 0 && pointingDeg < 60) prize = "çºªæ¢µå¸Œå°ç¾Šçš®å£çº¢";
                else if (pointingDeg >= 300 && pointingDeg < 360) prize = "ARMANIé˜¿ç›å°¼";
                else if (pointingDeg >= 240 && pointingDeg < 300) prize = "æ¢æ¢VIPä¼šå‘˜";
                else if (pointingDeg >= 180 && pointingDeg < 240) prize = "iPhone XS";
                else if (pointingDeg >= 120 && pointingDeg < 180) prize = "åœ£ç½—å…°å£çº¢";
                else if (pointingDeg >= 60 && pointingDeg < 120) prize = "è°¢è°¢å‚ä¸";

                // å¤„ç†ç»“æœ
                handleResult(prize);

            }, 4000);
        }

        // 5. ç»“æœå¤„ç†ä¸ä¿å­˜
        function handleResult(prize) {
            alert(`ğŸ‰ ç»“æœæ­æ™“ï¼š\n${prize}`);

            // è®°å½•ä»Šæ—¥å·²æŠ½
            const today = new Date().toLocaleDateString();
            localStorage.setItem(STORAGE_KEY_LAST_DATE, today);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            checkDailyStatus();

            // å¦‚æœä¸æ˜¯â€œè°¢è°¢å‚ä¸â€ï¼Œåˆ™ä¿å­˜åˆ°ä¸­å¥–åå•
            if (prize !== "è°¢è°¢å‚ä¸") {
                const newRecord = {
                    name: currentUser,
                    prize: prize,
                    time: new Date().toLocaleTimeString() // è®°å½•å…·ä½“æ—¶é—´
                };

                // è¯»å–æ—§æ•°æ® -> æ’å…¥æ–°æ•°æ® -> ä¿å­˜
                let records = JSON.parse(localStorage.getItem(STORAGE_KEY_RECORDS) || "[]");
                records.push(newRecord); // å­˜å…¥æ•°ç»„
                localStorage.setItem(STORAGE_KEY_RECORDS, JSON.stringify(records));

                // åˆ·æ–°ç•Œé¢åˆ—è¡¨
                renderRecords();
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨æŸ¥çœ‹æœ€æ–°è®°å½•
                document.getElementById('marqueeList').scrollTop = 0;
            }
        }
    </script>
</body>
</html>